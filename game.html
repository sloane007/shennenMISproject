<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="styles.css">
  <script src="https://w.soundcloud.com/player/api.js"></script>
  <title>Interactive Game</title>
  <style>
    :root{
      --nav-bg:#3b6b56;
      --accent:#c07a4b;
      --accent-light:#d68a60;
      --accent-dark:#a8693a;
      --muted:#6b6b57;
      --page-bg:#f6f3ee;
      --card-bg:#fffdf9;
      --text-primary:#2b2b26;
      --text-secondary:#4a4a45;
      --shadow-sm:0 2px 8px rgba(0,0,0,0.08);
      --shadow-md:0 6px 20px rgba(0,0,0,0.12);
      --shadow-lg:0 12px 32px rgba(0,0,0,0.16);
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;
      margin:0;
      padding:0;
      background:linear-gradient(135deg, #f6f3ee 0%, #f0ebe4 100%);
      color:var(--text-primary);
      line-height:1.7;
      letter-spacing:0.01em;
      min-height:100vh;
    }
    header{
      background:linear-gradient(135deg, var(--nav-bg) 0%, #2d5545 100%);
      color:#fff;
      padding:1rem 1.5rem;
      position:sticky;
      top:0;
      z-index:100;
      box-shadow:var(--shadow-md);
      backdrop-filter:blur(10px);
      border-bottom:1px solid rgba(255,255,255,0.1);
    }
    .menu-toggle{display:none;background:rgba(255,255,255,0.15);border:1px solid rgba(255,255,255,0.3);color:#fff;padding:0.6rem 1.2rem;border-radius:8px;cursor:pointer;font-weight:600;font-size:0.95rem;transition:all 0.3s ease;align-items:center;gap:0.5rem}
    .menu-toggle:hover{background:rgba(255,255,255,0.25)}
    .menu-toggle .arrow{font-size:0.75rem;transition:transform 0.3s ease}
    .menu-toggle.active .arrow{transform:rotate(180deg)}
    nav{max-width:1100px;margin:0 auto;display:flex;align-items:center;justify-content:space-between}
    ul{list-style:none;display:flex;gap:0.5rem;margin:0;padding:0}
    a{
      color:#fff;
      text-decoration:none;
      transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
      padding:0.6rem 1rem;
      border-radius:8px;
      display:inline-block;
      font-weight:500;
    }
    a:hover{
      background:rgba(255,255,255,0.2);
      transform:translateY(-2px);
      box-shadow:0 4px 12px rgba(0,0,0,0.15);
    }
    main{max-width:1100px;margin:3rem auto;padding:0 1.5rem}
  .card{
    background:var(--card-bg);
    padding:2.5rem;
    border-radius:16px;
    box-shadow:var(--shadow-sm);
    transition:all 0.4s cubic-bezier(0.4,0,0.2,1);
    opacity:0;
    animation:fadeInUp 0.6s ease forwards;
    border:1px solid rgba(59,107,86,0.08);
  }
  .card:hover{
    transform:translateY(-5px);
    box-shadow:var(--shadow-lg);
    border-color:rgba(192,122,75,0.2);
  }
  .back-btn{
    display:inline-block;
    padding:0.75rem 1.5rem;
    background:linear-gradient(135deg, var(--text-primary) 0%, #1a1a16 100%);
    color:#fff;
    border-radius:10px;
    text-decoration:none;
    transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
    margin-top:1.5rem;
    font-weight:600;
    box-shadow:var(--shadow-sm);
  }
  .back-btn:hover{
    background:linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
    transform:translateX(-5px);
    box-shadow:var(--shadow-md);
  }
  .mode-selector{
    display:flex;
    gap:1rem;
    justify-content:center;
    margin:2rem 0 1.5rem;
    flex-wrap:wrap;
  }
  .mode-btn{
    flex:1;
    min-width:160px;
    max-width:220px;
    background:linear-gradient(135deg, var(--nav-bg) 0%, #2d5545 100%);
  }
  .mode-btn.active{
    background:linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
    box-shadow:0 6px 20px rgba(192,122,75,0.4);
  }
  .mode-btn:hover{
    background:linear-gradient(135deg, var(--accent-light) 0%, var(--accent) 100%);
  }
  .game-status{
    text-align:center;
    margin:1.5rem 0;
  }
  .game-status h2{
    font-size:1.75rem;
    color:var(--accent);
    margin:0;
    transition:all 0.3s ease;
  }
  .game-board{
    display:grid;
    grid-template-columns:repeat(3, 1fr);
    gap:12px;
    max-width:400px;
    margin:2rem auto;
    padding:1rem;
    background:linear-gradient(135deg, #fff 0%, #fafafa 100%);
    border-radius:16px;
    box-shadow:var(--shadow-md);
  }
  .cell{
    aspect-ratio:1;
    background:#fff;
    border:3px solid var(--nav-bg);
    border-radius:12px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:3rem;
    font-weight:700;
    cursor:pointer;
    transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
    box-shadow:var(--shadow-sm);
    position:relative;
    overflow:hidden;
    padding:0.25rem;
  }
  .cell:hover:not(.taken){
    background:rgba(59,107,86,0.1);
    transform:scale(1.05);
    border-color:var(--accent);
    box-shadow:var(--shadow-md);
  }
  .cell.taken{
    cursor:not-allowed;
  }
  .cell.winning{
    background:linear-gradient(135deg, rgba(192,122,75,0.2) 0%, rgba(192,122,75,0.3) 100%);
    animation:pulse 0.5s ease-in-out;
  }
  @keyframes pulse{
    0%, 100%{transform:scale(1);}
    50%{transform:scale(1.1);}
  }
  .cell::before{
    content:'';
    position:absolute;
    inset:0;
    background:radial-gradient(circle at center, transparent 0%, rgba(255,255,255,0.8) 100%);
    opacity:0;
    transition:opacity 0.3s ease;
  }
  .cell:active:not(.taken)::before{
    opacity:1;
  }
  .btn{
    margin-top:12px;
    padding:0.875rem 2rem;
    border-radius:12px;
    background:linear-gradient(135deg, var(--nav-bg) 0%, #2d5545 100%);
    color:#fff;
    border:none;
    cursor:pointer;
    font-weight:700;
    font-size:1.1rem;
    transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
    box-shadow:0 4px 16px rgba(59,107,86,0.3);
    letter-spacing:0.02em;
  }
  .btn:hover{
    background:linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
    transform:scale(1.08) translateY(-2px);
    box-shadow:0 8px 24px rgba(192,122,75,0.4);
  }
  .btn:active{
    transform:scale(0.98) translateY(0);
  }
  .game-controls{
    display:flex;
    gap:1rem;
    margin:1.5rem 0;
    flex-wrap:wrap;
  }
  .game-controls button{
    flex:1;
    min-width:140px;
  }
  .instructions{
    background:linear-gradient(135deg, #fff 0%, #fafafa 100%);
    padding:1.5rem;
    border-radius:14px;
    margin-bottom:1.5rem;
    border-left:5px solid var(--accent);
    box-shadow:var(--shadow-sm);
  }
  .instructions h3{
    margin-top:0;
    color:var(--accent);
    font-size:1.25rem;
    font-weight:600;
  }
  .instructions p{
    color:var(--text-secondary);
    margin:0.5rem 0 0;
    line-height:1.7;
  }
  h1{
    opacity:0;
    animation:fadeInUp 0.6s ease 0.2s forwards;
    font-size:2.5rem;
    font-weight:700;
    margin:0 0 1.5rem;
    color:var(--text-primary);
    letter-spacing:-0.02em;
  }
  @keyframes fadeInUp{
    from{opacity:0;transform:translateY(20px)}
    to{opacity:1;transform:translateY(0)}
  }
  .brand{
    font-weight:700;
    cursor:pointer;
    transition:transform 0.2s ease;
    font-size:1.25rem;
    letter-spacing:0.02em;
    text-shadow:0 2px 4px rgba(0,0,0,0.1);
  }
  .brand:hover{
    transform:scale(1.05);
    text-shadow:0 2px 8px rgba(0,0,0,0.2);
  }
  .character-selector{
    background:linear-gradient(135deg, #fff 0%, #fafafa 100%);
    padding:1.5rem;
    border-radius:14px;
    margin:1.5rem 0;
    border-left:5px solid var(--accent);
    box-shadow:var(--shadow-sm);
  }
  .character-selector h3{
    margin-top:0;
    color:var(--accent);
    font-size:1.25rem;
    font-weight:600;
  }
  .player-selection{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:2rem;
    margin-top:1rem;
  }
  .player-box{
    background:#fff;
    padding:1rem;
    border-radius:12px;
    box-shadow:var(--shadow-sm);
  }
  .player-box h4{
    margin:0 0 0.75rem;
    color:var(--nav-bg);
    font-size:1.1rem;
  }
  .character-options{
    display:grid;
    grid-template-columns:repeat(3, 1fr);
    gap:0.75rem;
  }
  .character-option{
    aspect-ratio:1;
    background:#f9f9f9;
    border:3px solid #ddd;
    border-radius:10px;
    cursor:pointer;
    transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
    padding:0.5rem;
    display:flex;
    align-items:center;
    justify-content:center;
    overflow:hidden;
  }
  .character-option img{
    width:100%;
    height:100%;
    object-fit:contain;
  }
  .character-option:hover{
    transform:scale(1.1);
    border-color:var(--accent);
    box-shadow:var(--shadow-md);
  }
  .character-option.selected{
    border-color:var(--nav-bg);
    background:rgba(59,107,86,0.1);
    box-shadow:0 0 0 3px rgba(59,107,86,0.2);
  }
  .music-player{
    display:none;
  }
  .mute-button{
    position:fixed;
    bottom:2rem;
    right:2rem;
    width:50px;
    height:50px;
    border-radius:50%;
    background:linear-gradient(135deg, var(--nav-bg) 0%, #2d5545 100%);
    color:#fff;
    border:none;
    cursor:pointer;
    font-size:1.5rem;
    display:flex;
    align-items:center;
    justify-content:center;
    box-shadow:var(--shadow-lg);
    transition:all 0.3s cubic-bezier(0.4,0,0.2,1);
    z-index:50;
  }
  .mute-button:hover{
    background:linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%);
    transform:scale(1.1);
    box-shadow:0 8px 24px rgba(192,122,75,0.4);
  }
  .mute-button:active{
    transform:scale(0.95);
  }
  @media (max-width:1024px){
    .menu-toggle{display:flex}
    ul{display:none;position:absolute;top:100%;left:0;right:0;background:linear-gradient(135deg, var(--nav-bg) 0%, #2d5545 100%);flex-direction:column;padding:1rem;box-shadow:0 8px 16px rgba(0,0,0,0.2);border-top:1px solid rgba(255,255,255,0.1);margin-top:0;gap:0.5rem;max-height:0;overflow:hidden;opacity:0;transition:all 0.3s ease}
    ul.active{display:flex;max-height:500px;opacity:1}
    ul li{width:100%;text-align:center}
    ul a{display:block;padding:0.75rem 1rem;width:100%}
  }
  @media (max-width:768px){
    header{padding:0.75rem 1rem}
    nav{flex-direction:column;align-items:stretch;gap:0.75rem}
    ul{width:100%;justify-content:center;flex-wrap:wrap;gap:0.4rem}
    ul li{flex:0 1 auto}
    ul a{padding:0.5rem 0.75rem;font-size:0.85rem;white-space:nowrap}
    main{padding:0 1rem}
    .card{padding:2rem}
    h1{font-size:2rem}
    h2{font-size:1.5rem}
    h3{font-size:1.15rem}
    .player-selection{grid-template-columns:1fr;gap:1.5rem}
    .character-options{grid-template-columns:repeat(5, 1fr);gap:0.5rem}
    .game-board{max-width:350px;gap:10px}
    .cell{font-size:2.5rem}
    .mode-selector{flex-direction:column}
    .mode-btn{max-width:100%}
    .mute-button{bottom:1rem;right:1rem;width:45px;height:45px;font-size:1.3rem}
  }
  @media (max-width:480px){
    main{padding:0 0.75rem}
    .card{padding:1.5rem}
    h1{font-size:1.75rem}
    h2{font-size:1.3rem}
    .instructions{padding:1.25rem}
    .character-selector{padding:1.25rem}
    .player-box{padding:0.75rem}
    .character-options{grid-template-columns:repeat(5, 1fr);gap:0.4rem}
    .game-board{max-width:300px;gap:8px;padding:0.75rem}
    .cell{font-size:2rem;padding:0.15rem}
    header{padding:0.5rem 0.75rem}
    nav{gap:0.5rem}
    ul{flex-direction:row;gap:0.25rem;justify-content:center}
    ul li{flex:0 1 auto;min-width:0}
    ul a{display:block;text-align:center;padding:0.4rem 0.5rem;font-size:0.75rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .game-controls{flex-direction:column}
    .game-controls button{min-width:100%}
  }
  @media (max-width:360px){
    ul{flex-wrap:wrap;gap:0.2rem}
    ul a{padding:0.35rem 0.4rem;font-size:0.7rem}
    .mute-button{bottom:0.75rem;right:0.75rem;width:40px;height:40px;font-size:1.2rem}
  }
  
  /* Flappy Unicorn Game Styles */
  .game-shell {
      width: 100%;
      max-width: 100%;
      height: calc(100vh - 80px);
      max-height: 800px;
      position: relative;
      border-radius: 16px;
      box-shadow: 0 20px 50px rgba(91,42,80,0.2);
      background: radial-gradient(1200px 800px at 50% -200px, rgba(255, 182, 219, 0.6), transparent 60%),
                  linear-gradient(180deg, rgba(255,205,235,0.7) 0%, rgba(255,255,255,0.0) 40%);
      overflow: hidden;
      margin: 1rem auto;
  }
  
  @media (min-width: 768px) {
    .game-shell {
      max-width: 90%;
    }
  }
  
  @media (min-width: 1024px) {
    .game-shell {
      max-width: 1000px;
    }
  }
  #canvas {
      position: absolute;
      top: 0; left: 0; width: 100%; height: 100%;
  }
  .hud {
      position: absolute;
      top: 12px; left: 12px; right: 12px;
      display: flex; align-items: center; justify-content: space-between;
      z-index: 2;
      pointer-events: none;
  }
  .score {
      background: rgba(255,255,255,0.65);
      color: #5b2a50;
      padding: 8px 14px;
      border-radius: 999px;
      font-weight: 700;
      font-size: 16px;
      backdrop-filter: blur(6px);
  }
  .game-shell .btn {
      pointer-events: auto;
      background: linear-gradient(180deg, #ff8dc6 0%, #ff64b4 100%);
      color: white; border: none; border-radius: 999px;
      padding: 10px 16px; font-weight: 800; letter-spacing: .5px;
      box-shadow: 0 8px 18px rgba(255, 100, 180, .35);
      cursor: pointer;
      transition: transform .08s ease, filter .2s ease;
  }
  .game-shell .btn:active { transform: translateY(1px) scale(.99); }
  .music-btn {
      background: rgba(255,255,255,0.9);
      color: #5b2a50;
      border: 2px solid #ff8dc6;
      border-radius: 999px;
      padding: 10px 20px;
      font-weight: 700;
      font-size: 16px;
      cursor: pointer;
      transition: all .2s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
  }
  .music-btn:hover {
      background: #ffe0f1;
      transform: scale(1.05);
  }
  .music-btn:active { transform: scale(.98); }
  .audio-container {
      position: absolute;
      width: 1px;
      height: 1px;
      opacity: 0;
      pointer-events: none;
      overflow: hidden;
  }
  .center-overlay {
      position: absolute; inset: 0; display: grid; place-items: center; z-index: 3;
  }
  .game-shell .card {
      background: rgba(255,255,255,0.8);
      backdrop-filter: blur(8px);
      padding: 20px 18px;
      border-radius: 16px;
      width: min(84%, 520px);
      text-align: center;
      box-shadow: 0 14px 28px rgba(91,42,80,0.18);
  }
  .title { font-weight: 900; font-size: 28px; margin-bottom: 10px; }
  .subtitle { opacity: .85; margin-bottom: 16px; }
  .controls { font-size: 14px; opacity: .9; margin-top: 8px; }
  .pill {
      display: inline-block;
      padding: 6px 10px; border-radius: 999px; background: #ffe0f1; color:#5b2a50; font-weight: 700; margin: 0 4px;
  }
  .clouds { position: absolute; inset: 0; z-index: 0; overflow: hidden; pointer-events: none; }
  .cloud { position: absolute; background: rgba(255,255,255,0.95); border-radius: 999px; filter: blur(0.5px); }
  .cloud.one { width: 180px; height: 60px; top: 12%; left: -120px; animation: drift 42s linear infinite; }
  .cloud.two { width: 260px; height: 80px; top: 32%; left: -200px; animation: drift 55s linear infinite; opacity: .9; }
  .cloud.three { width: 140px; height: 48px; top: 68%; left: -160px; animation: drift 48s linear infinite; opacity: .85; }
  @keyframes drift { from { transform: translateX(0); } to { transform: translateX(120%); } }
  @media (prefers-reduced-motion: reduce) {
      .cloud.one, .cloud.two, .cloud.three { animation: none; }
  }
  @keyframes sparkle {
      0% { transform: scale(1); opacity: 0.8; }
      100% { transform: scale(0); opacity: 0; }
  }
</style>
</head>
<body>
  <header>
    <nav>
      <div style="font-weight:700">Sloane Hennen</div>
      <button class="menu-toggle" id="menuToggle" aria-label="Menu">
        <span>Game</span>
        <span class="arrow">▼</span>
      </button>
      <ul id="navMenu">
        <li><a href="index.html">Home</a></li>
        <li><a href="career.html">Career Intrests</a></li>
        <li><a href="discover.html">Discover</a></li>
        <li><a href="hobbies.html">Hobbies</a></li>
        <li><a href="game.html">Game</a></li>
        <li><a href="resume.html">Resume</a></li>
      </ul>
    </nav>
  </header>
  <main>
    <div class="game-shell" id="game">
      <div class="clouds">
          <div class="cloud one"></div>
          <div class="cloud two"></div>
          <div class="cloud three"></div>
      </div>
      <div class="hud">
          <div class="score" id="score">0</div>
          <button class="btn" id="btnRestart" aria-label="Restart" style="display:none">Restart</button>
      </div>
      <div class="audio-container">
          <iframe id="audioPlayer" width="100%" height="300" scrolling="no" frameborder="no" allow="autoplay" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/soundcloud%253Atracks%253A863890909&color=%2368514e&auto_play=false&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true&visual=true"></iframe>
      </div>
      <canvas id="canvas" width="360" height="640" aria-label="Flappy Unicorn Game Canvas"></canvas>
      <div class="center-overlay" id="overlay">
          <div class="card">
              <div class="title">Flappy Unicorn</div>
              <div class="subtitle">Glide through rainbow gates in a pink sky of clouds.</div>
              <div class="controls">Tap/Click • <span class="pill">Space</span> • <span class="pill">↑</span></div>
              <div style="height:10px"></div>
              <button class="music-btn" id="btnMusic">Music Playing</button>
              <div style="height:10px"></div>
              <button class="btn" id="btnPlay">Play</button>
              <div style="height:12px"></div>
              <div class="controls" id="bestLabel" style="display:none"></div>
          </div>
      </div>
    </div>
  </main>
  
  <script>
    // Menu toggle
    const menuToggle = document.getElementById('menuToggle');
    const navMenu = document.getElementById('navMenu');
    
    if (menuToggle && navMenu) {
      menuToggle.addEventListener('click', function(e) {
        e.stopPropagation();
        menuToggle.classList.toggle('active');
        navMenu.classList.toggle('active');
      });
      
      // Close menu when clicking on a nav link
      navMenu.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', function() {
          menuToggle.classList.remove('active');
          navMenu.classList.remove('active');
        });
      });
      
      // Close menu when clicking outside
      document.addEventListener('click', function(event) {
        if (!menuToggle.contains(event.target) && !navMenu.contains(event.target)) {
          menuToggle.classList.remove('active');
          navMenu.classList.remove('active');
        }
      });
    }
    
    // Brand click handler
    document.addEventListener('DOMContentLoaded', function() {
      const brand = document.querySelector('.brand') || document.querySelector('[style*="font-weight:700"]');
      if (brand) {
        brand.style.cursor = 'pointer';
        brand.addEventListener('click', function() {
          window.location.href = 'index.html';
        });
      }
    });
    
    // Flappy Unicorn Game
    (function(){
      const canvas = document.getElementById('canvas');
      const ctx = canvas.getContext('2d');
      const scoreEl = document.getElementById('score');
      const overlay = document.getElementById('overlay');
      const btnPlay = document.getElementById('btnPlay');
      const btnRestart = document.getElementById('btnRestart');
      const bestLabel = document.getElementById('bestLabel');
      const btnMusic = document.getElementById('btnMusic');
      const audioPlayer = document.getElementById('audioPlayer');

      // Audio control
      let isPlaying = false;
      let widget = null;
     
      // Initialize SoundCloud widget
      window.addEventListener('load', () => {
          widget = SC.Widget(audioPlayer);
      });
     
      btnMusic.addEventListener('click', () => {
          if (!widget) return;
         
          if (isPlaying) {
              widget.pause();
              btnMusic.innerHTML = 'No Music';
              isPlaying = false;
          } else {
              widget.play();
              btnMusic.innerHTML = 'Music Playing';
              isPlaying = true;
          }
      });

      const DPR = Math.min(window.devicePixelRatio || 1, 2);

      function resizeCanvas(){
          const rect = canvas.getBoundingClientRect();
          canvas.width = Math.round(rect.width * DPR);
          canvas.height = Math.round(rect.height * DPR);
          ctx.setTransform(DPR, 0, 0, DPR, 0, 0);
      }
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);

      // Game state
      let gameState = 'idle';
      let score = 0; 
      let best = Number(localStorage.getItem('flappyUnicornBest')||0);
      let frames = 0; 
      let lastTime = 0; 
      let rafId = null;

      // World constants
      const world = {
          gravity: 0.4,
          jumpVelocity: -8.5,
          unicornX: 88,
          gap: 280,
          pipeWidth: 60,
          pipeInterval: 140,
          speed: 2.2
      };

      // Entities
      const unicorn = { x: world.unicornX, y: 220, vy: 0, r: 18, t: 0 };
      const pipes = [];

      function reset(){
          score = 0; scoreEl.textContent = '0';
          unicorn.y = 220; unicorn.vy = 0; unicorn.t = 0;
          pipes.length = 0;
          frames = 0; lastTime = 0;
      }

      // Input
      function flap(){
          if (gameState === 'idle') start();
          if (gameState !== 'playing') return;
          unicorn.vy = world.jumpVelocity;
      }
      window.addEventListener('keydown', (e)=>{
          if (['Space','ArrowUp'].includes(e.code)) { e.preventDefault(); flap(); }
      });
      canvas.addEventListener('pointerdown', flap);
      btnPlay.addEventListener('click', start);
      btnRestart.addEventListener('click', ()=>{ reset(); start(); });

      function start(){
          reset();
          overlay.style.display = 'none';
          btnRestart.style.display = 'none';
          gameState = 'playing';
          cancelAnimationFrame(rafId);
          rafId = requestAnimationFrame(loop);
      }

      function end(){
          gameState = 'gameover';
          best = Math.max(best, score);
          localStorage.setItem('flappyUnicornBest', String(best));
          bestLabel.textContent = `Best: ${best}`;
          bestLabel.style.display = 'block';
          overlay.style.display = 'grid';
          btnRestart.style.display = 'inline-block';
      }

      function spawnPipe(){
          const hCanvas = canvas.height / DPR;
          const minTop = 80;
          const maxTop = hCanvas - world.gap - 80;
          const topH = minTop + Math.random() * (maxTop - minTop);
          pipes.push({ x: canvas.width / DPR + 20, topH, passed: false });
      }

      function drawBackground(){
          const w = canvas.width/DPR, h = canvas.height/DPR;
          const gradient = ctx.createLinearGradient(0,0,0,h);
          gradient.addColorStop(0,'#ffd1ec');
          gradient.addColorStop(0.4,'#ffe3f3');
          gradient.addColorStop(0.8,'#fff0f8');
          gradient.addColorStop(1,'#ffffff');
          ctx.fillStyle = gradient;
          ctx.fillRect(0,0,w,h);

          // Parallax soft clouds
          const cloud = (x,y,s,op) => {
              ctx.globalAlpha = op;
              ctx.fillStyle = '#fff';
              ctx.beginPath();
              ctx.ellipse(x, y, 22*s, 12*s, 0, 0, Math.PI*2);
              ctx.ellipse(x-16*s, y+4*s, 16*s, 10*s, 0, 0, Math.PI*2);
              ctx.ellipse(x+18*s, y+6*s, 18*s, 11*s, 0, 0, Math.PI*2);
              ctx.fill();
              ctx.globalAlpha = 1;
          };
          const t = frames;
          const baseSpeed = world.speed * 0.4;
          for (let i=0;i<5;i++) cloud((w+120) - ((t*baseSpeed + i*160) % (w+240)), 90 + i*80, 1 + (i%2)*0.2, 0.35);
      }

      function drawRainbowPipe(x, topH){
          const w = world.pipeWidth, gap = world.gap, h = canvas.height/DPR;
          const colors = ['#ff4aa2','#ff7ac8','#ffa6e3','#ffd1f2','#ffffff'];
          // Top pipe
          for (let i=0;i<colors.length;i++){
              ctx.fillStyle = colors[i];
              ctx.fillRect(x+i*2, 0, (w - i*4), topH);
          }
          // Bottom pipe
          const bottomY = topH + gap;
          for (let i=0;i<colors.length;i++){
              ctx.fillStyle = colors[i];
              ctx.fillRect(x+i*2, bottomY, (w - i*4), h - bottomY);
          }
          // Cloud caps
          const cap = (cx, cy) => {
              ctx.fillStyle = 'rgba(255,255,255,0.95)';
              ctx.beginPath();
              ctx.ellipse(cx+10, cy, 14, 8, 0, 0, Math.PI*2);
              ctx.ellipse(cx-6, cy+4, 18, 10, 0, 0, Math.PI*2);
              ctx.ellipse(cx+26, cy+6, 16, 9, 0, 0, Math.PI*2);
              ctx.fill();
          };
          cap(x + w*0.4, topH);
          cap(x + w*0.5, bottomY);
      }

      // Sparkle system
      const sparkles = [];
    
      function createSparkle(x, y) {
          return {
              x, y,
              size: Math.random() * 3 + 2,
              life: 1,
              color: `hsl(${Math.random() * 60 + 40}, 100%, 75%)`,
              vx: (Math.random() - 0.5) * 2,
              vy: (Math.random() - 0.5) * 2
          };
      }

      function updateAndDrawSparkles() {
          if (gameState === 'playing' && frames % 2 === 0) {
              sparkles.push(createSparkle(unicorn.x - 20, unicorn.y));
          }

          for (let i = sparkles.length - 1; i >= 0; i--) {
              const s = sparkles[i];
              s.life -= 0.04;
              s.x += s.vx;
              s.y += s.vy;
            
              if (s.life <= 0) {
                  sparkles.splice(i, 1);
                  continue;
              }

              ctx.beginPath();
              ctx.fillStyle = s.color;
              ctx.globalAlpha = s.life;
              const angleOffset = frames * 0.1;
              for (let j = 0; j < 5; j++) {
                  const angle = (j * Math.PI * 2 / 5) + angleOffset;
                  const x = s.x + Math.cos(angle) * s.size;
                  const y = s.y + Math.sin(angle) * s.size;
                  if (j === 0) {
                      ctx.moveTo(x, y);
                  } else {
                      ctx.lineTo(x, y);
                  }
              }
              ctx.closePath();
              ctx.fill();
              ctx.globalAlpha = 1;
          }
      }

      function drawUnicorn(){
          const x = unicorn.x, y = unicorn.y;
          const flapPhase = Math.sin(unicorn.t*0.35);
          // Body
          ctx.fillStyle = '#ffffff';
          ctx.beginPath();
          ctx.ellipse(x, y, 26, 20, 0, 0, Math.PI*2);
          ctx.fill();

          // Head
          ctx.beginPath();
          ctx.ellipse(x+20, y-4, 16, 13, 0, 0, Math.PI*2);
          ctx.fill();

          // Ear
          ctx.fillStyle = '#ffb9de';
          ctx.beginPath();
          ctx.moveTo(x+26, y-16);
          ctx.lineTo(x+18, y-8);
          ctx.lineTo(x+30, y-6);
          ctx.closePath();
          ctx.fill();

          // Eye
          ctx.fillStyle = '#5b2a50';
          ctx.beginPath();
          ctx.arc(x+26, y-3, 2.3, 0, Math.PI*2);
          ctx.fill();

          // Horn (gold)
          ctx.fillStyle = '#ffd86b';
          ctx.beginPath();
          ctx.moveTo(x+30, y-10);
          ctx.lineTo(x+42, y-16);
          ctx.lineTo(x+32, y-2);
          ctx.closePath();
          ctx.fill();

          // Mane (rainbow)
          const maneColors = ['#ff4aa2','#ff7ac8','#ffa6e3','#ffd1f2'];
          maneColors.forEach((c,i)=>{
              ctx.fillStyle = c;
              ctx.beginPath();
              ctx.ellipse(x+6, y-12 + i*6, 10, 6, 0, 0, Math.PI*2);
              ctx.fill();
          });

          // Tail (sway)
          const tailY = y + 8 + flapPhase*3;
          maneColors.forEach((c,i)=>{
              ctx.fillStyle = c;
              ctx.beginPath();
              ctx.ellipse(x-24, tailY + i*5, 10 - i*1.2, 5 - i*0.8, 0, 0, Math.PI*2);
              ctx.fill();
          });

          // Wings (flapping)
          ctx.save();
          ctx.translate(x-4, y-8);
          ctx.rotate(-0.4 + flapPhase*0.5);
          ctx.fillStyle = '#ffffff';
          ctx.beginPath();
          ctx.ellipse(0, 0, 16, 8, 0, 0, Math.PI*2);
          ctx.fill();
          ctx.restore();
      }

      function collide(){
          const h = canvas.height/DPR;
          if (unicorn.y + unicorn.r > h || unicorn.y - unicorn.r < 0) return true;
          for (const p of pipes){
              const withinX = unicorn.x + unicorn.r > p.x && unicorn.x - unicorn.r < p.x + world.pipeWidth;
              if (!withinX) continue;
              if (unicorn.y - unicorn.r < p.topH || unicorn.y + unicorn.r > p.topH + world.gap) return true;
          }
          return false;
      }

      function loop(ts){
          const w = canvas.width/DPR, h = canvas.height/DPR;
          const dt = Math.min(32, ts - lastTime || 16) / 16.6667;
          lastTime = ts;
          frames++;

          // Update
          if (frames % world.pipeInterval === 0) spawnPipe();
          unicorn.vy += world.gravity * dt;
          unicorn.y += unicorn.vy * dt;
          unicorn.t += dt * 10;

          for (const p of pipes){ p.x -= world.speed * dt * 60/60; }
          while (pipes.length && pipes[0].x + world.pipeWidth < -30) pipes.shift();

          for (const p of pipes){
              if (!p.passed && p.x + world.pipeWidth < unicorn.x){
                  p.passed = true; score++; scoreEl.textContent = String(score);
              }
          }

          // Draw
          ctx.clearRect(0,0,w,h);
          drawBackground();
          for (const p of pipes) drawRainbowPipe(p.x, p.topH);
          updateAndDrawSparkles();
          drawUnicorn();

          if (collide()) { end(); return; }
          if (gameState === 'playing') rafId = requestAnimationFrame(loop);
      }

      // Show best on idle
      if (best > 0) { bestLabel.textContent = `Best: ${best}`; bestLabel.style.display = 'block'; }
    })();
  </script>
 </body>
</html>